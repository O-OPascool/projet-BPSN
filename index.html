<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestion de Stock de Livres</title>

  <!-- Th√®me clair/sombre avant le CSS -->
  <script>
    if (
      localStorage.getItem('theme') === 'dark' ||
      (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    }
  </script>

  <!-- Google Fonts & OpenLibrary covers -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://covers.openlibrary.org">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <nav class="navbar">
      <a href="index.html" class="navbar-brand">BIBLIO</a>
      <ul class="navbar-links">
        <li><a href="fonctionnalites.html">üìÑ Fonctionnalit√©s</a></li>
      </ul>
      <button id="mode-toggle" class="mode-toggle-btn">üåô</button>
    </nav>
  </header>

  <div class="container">
    <h1>Recherche et Gestion de Stock</h1>

    <!-- Recherche ISBN -->
    <form id="isbn-form" class="form">
      <input type="text" id="isbn" placeholder="Entrez un ISBN (10 ou 13 chiffres)" required>
      <button type="button" id="scan-search-toggle" class="small-btn">üì∑</button>
      <select id="search-engine" title="Choisissez le moteur">
        <option value="auto" selected>Auto</option>
        <option value="google">Google</option>
        <option value="openlibrary">O.Library</option>
      </select>
      <button type="submit">Rechercher</button>
    </form>

    <!-- Formulaire manuel -->
    <button id="manual-add-toggle">‚ûï Ajouter un livre manuellement</button>
    <form id="manual-add-form" class="form hidden">
      <input type="text" id="manual-title"      placeholder="Titre du livre"                required>
      <input type="text" id="manual-author-full" placeholder="Auteur du livre"               required>
      <textarea id="manual-summary-full"         placeholder="R√©sum√©" rows="5"            required></textarea>
      <input type="text" id="manual-isbn"         placeholder="ISBN unique (obligatoire)" required>
      <button type="button" id="scan-manual-toggle" class="small-btn">üì∑</button>
      <input type="text" id="manual-cover-url"    placeholder="URL couverture ou Data URI (optionnel)">
      <select id="manual-room" required>
        <option value="">Salle‚Ä¶</option>
        <!-- ces options seront inject√©es dynamiquement par script.js -->
      </select>
      <input type="number" id="manual-stock"      placeholder="Stock initial" min="0">
      <button type="submit">Ajouter / Mettre √† jour</button>
    </form>

    <!-- Gestion des salles (toggle avec <details>) -->
    <details id="rooms-details" style="margin:2rem 0;">
      <summary style="cursor:pointer; font-size:1.2rem; font-weight:bold; color:#66b0ff;">
        ‚öôÔ∏è G√©rer les salles
      </summary>
      <div id="rooms-management" style="padding:1rem 0;">
        <input type="text" id="new-room" placeholder="Nouvelle salle‚Ä¶">
        <button id="add-room">Ajouter salle</button>
        <ul id="room-list"></ul>
      </div>
    </details>

    <!-- Overlay Scanner QuaggaJS -->
    <div id="scanner-container" class="hidden">
      <div id="scanner-video"></div>
      <button id="stop-scan">Arr√™ter le scan</button>
    </div>

    <!-- Spinner de chargement -->
    <div id="spinner" class="spinner hidden"></div>

    <!-- Onglets r√©sultats Google -->
    <div id="search-results" class="tabs hidden"></div>

    <!-- Infos du livre trouv√© / √† ajouter -->
    <div id="book-info" class="hidden">
      <img id="cover" alt="Image de couverture">
      <p><strong>Titre :</strong> <span id="title"></span></p>
      <p><strong>Auteur :</strong> <span id="author"></span></p>
      <p><strong>R√©sum√© :</strong> <span id="summary"></span></p>

      <!-- √©dition manuelle d'un r√©sultat API -->
      <button id="fill-info-button" class="small-btn hidden">Compl√©ter les infos</button>
      <div id="manual-edit" class="hidden">
        <label>Auteur : <input type="text" id="manual-author"></label><br>
        <label>R√©sum√© : <textarea id="manual-summary" rows="4"></textarea></label><br>
        <button id="save-manual-info">Enregistrer</button>
        <button id="cancel-manual-info">Annuler</button>
      </div>

      <label for="room-select">Salle :</label>
      <select id="room-select">
        <option value="">‚Äî</option>
        <!-- options inject√©es dynamiquement -->
      </select>

      <p><strong>Disponibilit√© :</strong> <span id="stock" class="stock-info">‚Äî</span></p>

      <button id="confirm-add-book" style="display:none;">Confirmer l'ajout</button>
      <button id="cancel-add-book"  style="display:none;">Annuler</button>

      <!-- Formulaire de mise √† jour du stock -->
      <form id="stock-form" class="stock-form">
        <label for="new-stock">Mettre √† jour le stock :</label>
        <input type="number" id="new-stock" placeholder="Nombre d'exemplaires" required>
        <button type="submit">Mettre √† jour</button>
      </form>
    </div>

    <!-- Filtre + Liste des livres -->
    <h2>Liste des Livres Disponibles</h2>
    <div class="search-filters" style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
      <input type="text" id="search-book" placeholder="Rechercher par titre ou auteur‚Ä¶" style="flex:1; min-width:200px;">
      <select id="filter-room" style="width:10rem;">
        <option value="">Toutes les salles</option>
        <!-- options inject√©es dynamiquement -->
      </select>
    </div>
    <div id="book-list"></div>
    <div id="total-books-count" class="total-books">Total des livres disponibles : 0</div>
  </div>

  <footer class="text-center py-6 bg-gray-200 dark:bg-gray-800 dark:text-gray-400 transition-colors duration-500">
    <p>&copy; 2025 ‚Äì Chef d‚Äô≈ìuvre BIBLIO<br>Tous droits r√©serv√©s</p>
  </footer>

  <!-- QuaggaJS + script principal -->
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
  <script type="module" src="script.js"></script>
</body>
</html>
