<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>La th√®que  ‚Äì Gestion Stock</title>
  <!-- pr√©-load theme -->
  <script>
    if (
      localStorage.getItem('theme') === 'dark' ||
      (!localStorage.getItem('theme') &&
       window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    }
  </script>

  <!-- Google Fonts + CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://covers.openlibrary.org">
  <link rel="stylesheet" href="styles.css">

  <!-- QuaggaJS en global -->
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
</head>
<body>
  <header>
    <nav class="navbar">
      <a href="index.html" class="navbar-brand">La th√®que</a>
      <ul class="navbar-links">
        <li><a href="fonctionnalites.html">üìÑ Fonctionnalit√©s</a></li>
      </ul>
      <button id="mode-toggle" class="mode-toggle-btn">üåô</button>
    </nav>
  </header>

  <main class="container">
    <h1>Recherche &amp; Gestion de Stock</h1>

    <!-- Recherche ISBN + scan -->
    <form id="isbn-form" class="form">
      <input type="text" id="isbn" placeholder="Entrez un ISBN (10 ou 13 chiffres)" required>
      <button type="button" id="scan-search-toggle" class="small-btn">üì∑</button>
      <select id="search-engine" title="Choisissez moteur">
        <option value="auto" selected>Auto</option>
        <option value="google">Google</option>
        <option value="openlibrary">O.Library</option>
      </select>
      <button type="submit">Rechercher</button>
    </form>

    <!-- Manuel add toggle -->
    <button id="manual-add-toggle">‚ûï Ajouter manuel</button>
    <form id="manual-add-form" class="form hidden">
      <input type="text"    id="manual-title"       placeholder="Titre"       required>
      <input type="text"    id="manual-author-full" placeholder="Auteur"      required>
      <textarea            id="manual-summary-full" placeholder="R√©sum√©" rows="4" required></textarea>
      <input type="text"    id="manual-isbn"         placeholder="ISBN"        required>
      <button type="button" id="scan-manual-toggle" class="small-btn">üì∑</button>
      <input type="text"    id="manual-cover-url"    placeholder="URL couverture">
      <select              id="manual-room"         required>
        <option value="">Salle‚Ä¶</option>
      </select>
      <input type="number"  id="manual-stock"        placeholder="Stock initial" min="0">
      <button type="submit">Valider</button>
    </form>

    <!-- G√©rer salles -->
    <details style="margin:2rem 0;">
      <summary class="summary-btn">‚öôÔ∏è G√©rer les salles</summary>
      <div class="form">
        <input type="text" id="new-room" placeholder="Nouvelle salle‚Ä¶">
        <button id="add-room">Ajouter salle</button>
        <ul id="room-list"></ul>
      </div>
    </details>

    <!-- Scanner overlay -->
    <div id="scanner-container" class="hidden">
      <div id="scanner-video"></div>
      <button id="stop-scan">Arr√™ter le scan</button>
    </div>

    <!-- Spinner -->
    <div id="spinner" class="spinner hidden"></div>

    <!-- Google tabs -->
    <div id="search-results" class="tabs hidden"></div>

    <!-- Infos livre trouv√© -->
    <div id="book-info" class="hidden">
      <img id="cover" alt="Couverture">
      <p><strong>Titre :</strong> <span id="title"></span></p>
      <p><strong>Auteur :</strong> <span id="author"></span></p>
      <p><strong>R√©sum√© :</strong> <span id="summary"></span></p>
      <button id="fill-info-button" class="small-btn hidden">Compl√©ter infos</button>
      <div id="manual-edit" class="hidden">
        <label>Auteur : <input id="manual-author"></label><br>
        <label>R√©sum√© : <textarea id="manual-summary" rows="3"></textarea></label><br>
        <button id="save-manual-info">Enregistrer</button>
        <button id="cancel-manual-info">Annuler</button>
      </div>
      <label>Salle :
        <select id="room-select"><option value="">‚Äî</option></select>
      </label>
      <p><strong>Stock :</strong> <span id="stock">‚Äî</span></p>
      <button id="confirm-add-book" class="hidden">Confirmer</button>
      <button id="cancel-add-book" class="hidden">Annuler</button>
      <form id="stock-form" class="stock-form">
        <input type="number" id="new-stock" placeholder="Nouveau stock" min="0" required>
        <button type="submit">Mettre √† jour</button>
      </form>
    </div>

    <!-- Filtre + liste -->
    <h2>Livres disponibles</h2>
    <input type="text" id="search-book" placeholder="Filtrer titre/auteur‚Ä¶">
    <select id="filter-room"><option value="">Toutes</option></select>
    <div id="book-list"></div>
    <div id="total-books-count" class="total-books">Total de livres disponibles : 0</div>
  </main>

  <footer class="text-center py-6">
    &copy; 2025 ‚Äì Chef-d‚Äô≈ìuvre La th√®que
  </footer>

  <!-- Firebase + main script -->
  <script type="module" src="script.js"></script>
</body>
</html>
