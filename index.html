<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestion de Stock de Livres</title>

  <!-- ThÃ¨me clair/sombre avant le CSS -->
  <script>
    if (
      localStorage.getItem('theme') === 'dark' ||
      (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    }
  </script>

  <!-- Google Fonts & OpenLibrary covers -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://covers.openlibrary.org">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <nav class="navbar">
      <a href="index.html" class="navbar-brand">BIBLIO</a>
      <ul class="navbar-links">
        <li><a href="fonctionnalites.html">ðŸ“„ FonctionnalitÃ©s</a></li>
      </ul>
      <button id="mode-toggle" class="mode-toggle-btn">ðŸŒ™</button>
    </nav>
  </header>

  <div class="container">
    <h1>Recherche et Gestion de Stock</h1>

    <!-- Recherche ISBN -->
    <form id="isbn-form" class="form">
      <input type="text" id="isbn" placeholder="Entrez un ISBN (10 ou 13 chiffres)" required>
      <button type="button" id="scan-search-toggle" class="small-btn">ðŸ“·</button>
      <select id="search-engine" title="Choisissez le moteur">
        <option value="auto" selected>Auto</option>
        <option value="google">Google</option>
        <option value="openlibrary">O.Library</option>
      </select>
      <button type="submit">Rechercher</button>
    </form>

    <!-- Formulaire manuel (API) -->
    <div id="book-info" class="hidden">
      <img id="cover" alt="Image de couverture">
      <p><strong>Titre :</strong> <span id="title"></span></p>
      <p><strong>Auteur :</strong> <span id="author"></span></p>
      <p><strong>RÃ©sumÃ© :</strong> <span id="summary"></span></p>

      <!-- RÃ‰-AJOUT de lâ€™Ã©dition manuelle API -->
      <button id="fill-info-button" class="hidden">ComplÃ©ter les informations</button>
      <div id="manual-edit" class="hidden">
        <label for="manual-author">Auteur :</label>
        <input type="text" id="manual-author">
        <label for="manual-summary">RÃ©sumÃ© :</label>
        <textarea id="manual-summary" rows="5"></textarea>
        <button id="save-manual-info">Enregistrer</button>
        <button id="cancel-manual-info">Annuler</button>
      </div>

      <!-- CatÃ©gorisation par salle -->
      <label for="room-select"><strong>Salle :</strong></label>
      <select id="room-select">
        <option value="">â€”</option>
        <option value="Salon">Salon</option>
        <option value="Bureau">Bureau</option>
        <option value="Chambre">Chambre</option>
      </select>

      <p><strong>DisponibilitÃ© :</strong> <span id="stock" class="stock-info">â€”</span></p>
      <button id="confirm-add-book" style="display:none;">Confirmer l'ajout</button>
      <button id="cancel-add-book"  style="display:none;">Annuler</button>
    </div>

    <!-- Bouton et formulaire dâ€™ajout manuel complet -->
    <button id="manual-add-toggle">âž• Ajouter un livre manuellement</button>
    <form id="manual-add-form" class="form hidden">
      <input type="text" id="manual-title"      placeholder="Titre du livre"                required>
      <input type="text" id="manual-author-full" placeholder="Auteur du livre"               required>
      <textarea id="manual-summary-full"         placeholder="RÃ©sumÃ©" rows="5"            required></textarea>
      <input type="text" id="manual-isbn"         placeholder="ISBN unique (obligatoire)" required>
      <button type="button" id="scan-manual-toggle" class="small-btn">ðŸ“·</button>
      <input type="text" id="manual-cover-url"    placeholder="URL couverture ou Data URI (optionnel)">
      <select id="manual-room" required>
        <option value="">Salleâ€¦</option>
        <option value="Salon">Salon</option>
        <option value="Bureau">Bureau</option>
        <option value="Chambre">Chambre</option>
      </select>
      <input type="number" id="manual-stock"      placeholder="Stock initial" min="0">
      <button type="submit">Ajouter / Mettre Ã  jour</button>
    </form>

    <!-- Overlay Scanner QuaggaJS -->
    <div id="scanner-container" class="hidden">
      <div id="scanner-video"></div>
      <button id="stop-scan">ArrÃªter le scan</button>
    </div>

    <!-- Spinner de chargement -->
    <div id="spinner" class="spinner hidden"></div>

    <!-- Onglets rÃ©sultats Google -->
    <div id="search-results" class="tabs hidden"></div>

    <!-- Filtre + Liste des livres -->
    <h2>Liste des Livres Disponibles</h2>
    <input type="text" id="search-book" placeholder="Rechercher par titre ou auteurâ€¦">
    <div id="book-list"></div>
    <div id="total-books-count" class="total-books">Total des livres disponibles : 0</div>
  </div>

  <footer class="text-center py-6 bg-gray-200 dark:bg-gray-800 dark:text-gray-400 transition-colors duration-500">
    <p>&copy; 2025 â€“ Chef dâ€™Å“uvre BIBLIO<br>Tous droits rÃ©servÃ©s</p>
  </footer>

  <!-- QuaggaJS pour le scan -->
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
  <!-- Votre script principal -->
  <script type="module" src="script.js"></script>
</body>
</html>
